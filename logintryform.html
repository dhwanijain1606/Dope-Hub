<?php
$showAlert = false;
$showError = false;
if($_SERVER["REQUEST_METHOD"] == "POST"){
    include '_dbconnect.php';
    $username = $_POST["username"];
    $password = $_POST["password"];
    $cpassword = $_POST["cpassword"];
    $exists=false;
    if(($password == $cpassword) && $exists==false){
        $sql = "INSERT INTO `users` ( `username`, `password`, `dt`) VALUES ('$username', '$password', current_timestamp())";
        $result = mysqli_query($conn, $sql);
        if ($result){
            $showAlert = true;
        }
    }
    else{
        $showError = "Passwords do not match";
    }
}
    
?>

<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" -->
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/tsparticles-confetti@2.12.0/tsparticles.confetti.bundle.min.js"></script>
    <link rel="stylesheet" href="./logintryform.css">

    <title>SignUp</title>
    <script>   function bomb() {
            const end = Date.now() + 1 * 1000;

            // go Buckeyes!
            const colors = ["#007acc", "#ffffff"];
            const defaults = {
                spread: 360,
                ticks: 100,
                gravity: 0,
                decay: 0.94,
                startVelocity: 30,
                shapes: ["heart"],
                colors: ["#007acc", "#fff", "#569cd6", "blue"],
            };
            confetti({
                ...defaults,
                particleCount: 50,
                scalar: 2,
            });

            confetti({
                ...defaults,
                particleCount: 25,
                scalar: 3,
            });

            confetti({
                ...defaults,
                particleCount: 25,
                scalar: 4,
            });

            (function frame() {
                confetti({
                    particleCount: 2,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: colors,
                });

                confetti({
                    particleCount: 2,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: colors,
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            })();
        }
    </script>
    <link rel="stylesheet" href="signup.css">
</head>

<body>
    <?php require 'partials/_nav.php' ?>
    <?php
    if($showAlert ){
    echo'<div class="alert alert-success alert-dismissible fade show successButton" role="alert">
        <strong>Success!</strong> Success! Now you can login
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">×</span>
        </button>
    </div>';
    
    echo "<script>bomb();</script>" ;
    

    }
    if($showError){
    echo ' <div class="alert alert-danger alert-dismissible fade show alertButton" role="alert">
        <strong>Error!</strong> '. $showError.'
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">×</span>
        </button>
    </div> ';
   
    }
    ?>


    <div class=" container whitebox ">
        <h1 class="text-center">Signup to our website</h1>
        <form action="/loginsystem/signup.php" method="post">
         
            

                
                <div class="form-control">
                    <input type="text" id="username" name="username" required="">
                    <label>
                        <span style="transition-delay:0ms">U</span>
                        <span style="transition-delay:50ms">s</span>
                        <span style="transition-delay:100ms">e</span>
                        <span style="transition-delay:150ms">r</span>
                        <span style="transition-delay:200ms">n</span>
                        <span style="transition-delay:250ms">a</span>
                        <span style="transition-delay:300ms">m</span>
                        <span style="transition-delay:350ms">e</span>
                    </label>
                </div>
                <div class="form-control2">
                        <input type="text" id="password" name="password" required="">                    <label>
                        <span style="transition-delay:0ms">p</span>
                        <span style="transition-delay:50ms">a</span>
                        <span style="transition-delay:100ms">s</span>
                        <span style="transition-delay:150ms">s</span>
                        <span style="transition-delay:200ms">w</span>
                        <span style="transition-delay:250ms">o</span>
                        <span style="transition-delay:300ms">r</span>
                        <span style="transition-delay:350ms">d</span>
                    </label>
                </div>
                <div class="form-control3">
                <input type="password" id="cpassword" name="cpassword" ="">
                    <label>
                        <span style="transition-delay:0ms">U</span>
                        <span style="transition-delay:50ms">s</span>
                        <span style="transition-delay:100ms">e</span>
                        <span style="transition-delay:150ms">r</span>
                        <span style="transition-delay:200ms">n</span>
                        <span style="transition-delay:250ms">a</span>
                        <span style="transition-delay:300ms">m</span>
                        <span style="transition-delay:350ms">e</span>
                    </label>
                </div>
            

            

                
                
            
            

                <small id="emailHelp" class=" text-muted">Make sure to type the same password</small>
            
                <div class="buttons">
                <button type="submit" class=" tichuk btn btn-primary">SignUp</button>
                <button id="submit" type="reset" class="tichuk btn btn-primary" onclick="bomb()">Reset</button>
            </div>
        </form>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->


</body>

</html>